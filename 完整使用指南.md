# SmartTA 插件完整使用指南

本指南将带您从零开始配置和使用 SmartTA 插件系统（IntelliJ IDEA 插件 + Java 后端）。

## 📋 目录

1. [环境准备](#环境准备)
2. [后端配置和启动](#后端配置和启动)
3. [插件安装和配置](#插件安装和配置)
4. [功能使用](#功能使用)
5. [常见问题](#常见问题)

---

## 一、环境准备

### 1.1 检查必要的软件

您需要以下软件：

✅ **Java 17或21**（后端必需，推荐使用21）
```bash
# 检查已安装的 Java 版本
java -version
```

✅ **Maven 3.8+**（后端构建必需）
```bash
mvn -version
# 应该显示 Apache Maven 3.x.x
```

✅ **IntelliJ IDEA**（运行插件必需）
- 版本：2021.3 或更高
- 已安装 Kotlin 插件（通常默认已安装）

✅ **DeepSeek API 密钥**
- 访问：https://platform.deepseek.com
- 注册账号并获取 API Key

### 1.2 准备课程 PDF 文件

将您的课程 PDF 文件放到以下位置：
```bash
./SmartTA/SmartTA/src/pdf/
```

例如：
```
SmartTA/src/pdf/
├── L1.pdf
├── L2.pdf
├── L3.pdf
└── ...
```

---

## 二、后端配置和启动

### 2.1 配置 API 密钥

进入后端目录：
```bash
cd ./SmartTA/SmartTA-Backend-Java
```

编辑配置文件`.env`：
```bash
# DeepSeek API Configuration
DEEPSEEK_API_KEY=sk-
DEEPSEEK_BASE_URL=https://api.deepseek.com
```

或修改`./src/main/resources/application.yml`文件：
```yaml
  # DeepSeek API Configuration
  deepseek:
    api-key: ${DEEPSEEK_API_KEY:sk-}
    base-url: ${DEEPSEEK_BASE_URL:https://api.deepseek.com}
```

保存并退出（如果用 nano：Ctrl+X，然后 Y，然后 Enter）。

### 2.2 构建后端项目
```bash
# 使用Java 17或21，具体路径切换成自己设备上jdk的位置
export JAVA_HOME=/Users/renhongzhen/Library/Java/JavaVirtualMachines/graalvm-jdk-21.0.7/Contents/Home

# 编译项目
mvn clean compile
```

您应该看到：
```
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
```

### 2.3 启动后端服务
在IDE中直接运行 `SmartTAApplication.java` 的main方法。

### 2.4 验证后端启动成功

后端启动后，您应该看到类似输出：
```
  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::

...
Started SmartTAApplication in 15.234 seconds
```

打开新的终端窗口，测试健康检查：
```bash
curl http://localhost:8000/health
```

预期响应：
```json
{
  "status": "healthy",
  "timestamp": "2025-10-29T...",
  "model_ready": true
}
```

✅ **后端配置完成！保持这个终端窗口运行，不要关闭。**

---

## 三、插件安装和配置

### 3.1 构建插件

打开新的终端窗口：

```bash
cd ./SmartTA/SmartTA

# 构建插件
./gradlew buildPlugin
```

构建成功后，插件 ZIP 文件位于：
```
SmartTA/build/distributions/SmartTA-1.0-SNAPSHOT.zip
```

### 3.2 在 IntelliJ IDEA 中安装插件

1. **打开 IntelliJ IDEA**

2. **进入插件设置**
   - macOS: `IntelliJ IDEA` → `Settings/Preferences` → `Plugins`
   - 或按快捷键: `Cmd + ,` 然后点击 `Plugins`

3. **安装插件**
   - 点击 ⚙️（齿轮图标）→ `Install Plugin from Disk...`
   - 选择: `./SmartTA/SmartTA/build/distributions/SmartTA-1.0-SNAPSHOT.zip`
   - 点击 `OK`

4. **重启 IDEA**
   - 点击 `Restart IDE` 按钮
   - 等待 IDEA 重启完成

### 3.3 验证插件安装

重启后，您应该能看到：

1. **工具窗口**：在 IDEA 右侧或底部看到 "SmartTA" 工具窗口
2. **右键菜单**：在代码编辑器中右键，能看到 "Ask SmartTA" 选项

---

## 四、功能使用

### 4.1 上传 PDF 到知识库

在使用问答功能前，需要先上传 PDF 文件到知识库。

**方式 1：自动上传（如果 PDF 在标准位置）**

后端启动时会自动扫描 `../SmartTA/src/pdf` 目录，如果找到 PDF 会提示您上传。

**方式 2：手动上传单个文件**

```bash
curl -X POST http://localhost:8000/add_pdfs \
  -F "file=@/Users/renhongzhen/GitHub/SmartTA/SmartTA/src/pdf/L1.pdf"
```

**方式 3：批量上传目录**

```bash
curl -X POST http://localhost:8000/add_pdfs \
  -F "directory=/Users/renhongzhen/GitHub/SmartTA/SmartTA/src/pdf"
```

成功后您会看到：
```json
{
  "status": "success",
  "message": "Database updated successfully. Added 245 new document chunks.",
  "added_docs": 245
}
```

### 4.2 使用智能问答功能

#### 方式 1：使用 SmartTA 工具窗口

1. **打开工具窗口**
   - 点击 IDEA 右侧的 "SmartTA" 标签
   - 或使用菜单: `View` → `Tool Windows` → `SmartTA`

2. **提问**
   - 在输入框中输入您的问题，例如：
     ```
     什么是虚拟内存？
     ```
   - 点击 "Ask" 按钮

3. **查看答案**
   - 答案会显示在下方的文本区域
   - 支持多轮对话（系统会记住上下文）

#### 方式 2：右键菜单快速提问

1. **选中代码**（可选）
   - 如果您想问关于特定代码的问题，先选中相关代码

2. **右键菜单**
   - 在编辑器中右键
   - 选择 "Ask SmartTA"

3. **输入问题**
   - 在弹出的对话框中输入问题
   - 如果之前选中了代码，系统会自动包含代码上下文

4. **查看答案**
   - 答案会在对话框中显示

#### 示例对话

**Q1**: 什么是操作系统？
**A**: 操作系统是管理计算机硬件和软件资源的系统软件...（根据课程PDF内容回答）

**Q2**: 它有哪些主要功能？
**A**: 操作系统的主要功能包括：1. 进程管理 2. 内存管理 3. 文件系统...（理解"它"指的是操作系统）

### 4.3 生成单元测试

1. **选中要测试的方法**
   ```java
   public int add(int a, int b) {
       return a + b;
   }
   ```

2. **右键菜单**
   - 右键 → `Generate Test for Method`

3. **填写测试需求**
   - 在对话框中描述测试需求：
     ```
     测试加法功能，包括正数、负数、零和边界值
     ```

4. **查看生成的测试**
   - 系统会生成完整的 JUnit 测试代码
   - 包含 @Test 注解、断言等

### 4.4 生成项目文档

1. **右键项目或包**
   - 在项目视图中右键
   - 选择 "Generate Docs"

2. **查看生成的文档**
   - 系统会扫描项目结构
   - 生成 Markdown 格式的项目文档
   - 包括类说明、方法列表、架构概览等

### 4.5 上传新的 PDF 文件

如果您想添加更多课程材料：

**通过工具窗口上传**
1. 打开 SmartTA 工具窗口
2. 点击 "Upload PDF" 按钮
3. 选择 PDF 文件
4. 等待处理完成

**通过 API 上传**
```bash
curl -X POST http://localhost:8000/add_pdfs \
  -F "file=@/path/to/new_lecture.pdf"
```

---

## 五、常见使用场景

### 场景 1：学习课程内容

**提问**：
```
什么是进程和线程的区别？
```

**系统会**：
- 从课程 PDF 中检索相关内容
- 引用具体的课程资料（如 "见《Lecture 3》第 12 页"）
- 提供详细解释

### 场景 2：调试代码问题

1. 选中有问题的代码：
```java
for(int i = 0; i <= arr.length; i++) {
    System.out.println(arr[i]);
}
```

2. 右键 → "Ask SmartTA"

3. 问：
```
这段代码有什么问题？
```

4. 系统会指出数组越界问题并给出修复建议

### 场景 3：快速生成测试

1. 选中方法
2. 右键 → "Generate Test for Method"
3. 描述需求："测试各种输入情况"
4. 获得完整测试代码

### 场景 4：理解项目架构

1. 右键项目根目录
2. "Generate Docs"
3. 获得项目的完整文档说明

---

## 六、常见问题

### Q1: 后端启动失败

**检查**：
```bash
# 1. 确认 Java 17
java -version

# 2. 确认端口 8000 未被占用
lsof -i :8000

# 3. 查看日志
tail -f smartta.log
```

### Q2: 插件无法连接后端

**解决**：
1. 确认后端正在运行：
```bash
curl http://localhost:8000/health
```

2. 检查防火墙设置
3. 尝试重启 IDEA

### Q3: 问答没有引用课程资料

**原因**：可能 PDF 还没上传到知识库

**解决**：
```bash
# 上传 PDF
curl -X POST http://localhost:8000/add_pdfs \
  -F "directory=/Users/renhongzhen/GitHub/SmartTA/SmartTA/src/pdf"

# 验证
curl http://localhost:8000/health
# 确认 model_ready 为 true
```

### Q4: 生成的答案不理想

**优化建议**：
1. 提问更具体
2. 提供代码上下文
3. 使用多轮对话逐步细化问题

### Q5: 如何停止后端

按 `Ctrl + C` 在运行后端的终端中。

### Q6: 如何查看完整日志

```bash
cd /Users/renhongzhen/GitHub/SmartTA/SmartTA-Backend-Java
tail -f smartta.log
```

---

## 七、高级配置

### 7.1 修改后端端口

编辑 `application.yml`：
```yaml
server:
  port: 8080  # 改为其他端口
```

### 7.2 调整 RAG 参数

编辑 `application.yml`：
```yaml
smartta:
  rag:
    top-k: 5        # 返回更多相关文档
    chunk-size: 1500  # 更大的文本块
    chunk-overlap: 300
```

### 7.3 调整 LLM 参数

编辑 `application.yml`：
```yaml
smartta:
  model:
    llm:
      temperature: 0.7  # 更有创造性（0-1）
      max-tokens: 2048  # 更长的回答
```

### 7.4 配置日志级别

编辑 `application.yml`：
```yaml
logging:
  level:
    root: INFO
    com.example.smartta: DEBUG  # 详细日志
```

---

## 八、完整工作流程示例

### 示例：学习并实践操作系统课程

**第 1 步：启动系统**
```bash
# 终端 1: 启动后端
cd /Users/renhongzhen/GitHub/SmartTA/SmartTA-Backend-Java
./start.sh
```

**第 2 步：上传课程材料**
```bash
# 终端 2: 上传 PDF
curl -X POST http://localhost:8000/add_pdfs \
  -F "directory=/Users/renhongzhen/GitHub/SmartTA/SmartTA/src/pdf"
```

**第 3 步：打开 IDEA 和项目**

**第 4 步：学习概念**
- 打开 SmartTA 工具窗口
- 问："什么是虚拟内存？它是如何工作的？"
- 阅读答案，理解概念

**第 5 步：编写代码**
- 根据学到的知识编写代码

**第 6 步：遇到问题时提问**
- 选中有问题的代码
- 右键 → "Ask SmartTA"
- 问："这段代码有什么问题？"

**第 7 步：生成测试**
- 选中方法
- 右键 → "Generate Test for Method"
- 获得测试代码

**第 8 步：生成文档**
- 完成项目后
- 右键项目 → "Generate Docs"
- 获得项目文档

---

## 九、性能优化建议

### 9.1 后端性能

如果遇到响应慢：
```bash
# 增加 JVM 内存
java -Xmx4g -jar target/smartta-backend-1.0.0.jar
```

### 9.2 加快启动速度

使用 GraalVM 的 Native Image（高级）：
```bash
# 需要 GraalVM
mvn -Pnative package
```

### 9.3 批量处理 PDF

如果有很多 PDF 文件，分批上传：
```bash
# 每次上传 5 个文件
for file in /path/to/pdfs/*.pdf; do
    curl -X POST http://localhost:8000/add_pdfs -F "file=@$file"
    sleep 2  # 等待处理
done
```

---

## 十、总结

### ✅ 您现在可以：

1. ✨ **智能问答** - 基于课程 PDF 的智能助教
2. 🧪 **自动生成测试** - 一键生成 JUnit 测试
3. 📖 **生成项目文档** - 自动生成 Markdown 文档
4. 💬 **多轮对话** - 支持上下文理解的连续对话
5. 📚 **知识库管理** - 随时添加新的学习材料

### 🎯 快速开始命令

```bash
# 1. 启动后端
cd /Users/renhongzhen/GitHub/SmartTA/SmartTA-Backend-Java
./start.sh

# 2. 上传 PDF（新终端）
curl -X POST http://localhost:8000/add_pdfs \
  -F "directory=/Users/renhongzhen/GitHub/SmartTA/SmartTA/src/pdf"

# 3. 打开 IntelliJ IDEA，开始使用！
```

---

**祝您使用愉快！SmartTA 将成为您学习和开发的好帮手！** 🎉

