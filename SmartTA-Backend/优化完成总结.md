# SmartTA åç«¯ä¼˜åŒ–å®Œæˆæ€»ç»“

## âœ… å·²å®Œæˆçš„ä¼˜åŒ–

### 1. åˆ›å»ºä¼šè¯ç®¡ç†å™¨ (ConversationManager)
ğŸ“ `rag_engine/conversation_manager.py`
- âœ… çº¿ç¨‹å®‰å…¨çš„ä¼šè¯å†å²ç®¡ç†
- âœ… æ”¯æŒå¤šç”¨æˆ·å¹¶å‘è®¿é—®
- âœ… è‡ªåŠ¨æ¸…ç†æ—§ä¼šè¯

### 2. ä¼˜åŒ–æ£€ç´¢æ¨¡å— (retriever.py)
ğŸ“ `rag_engine/retriever.py`
- âœ… ä½¿ç”¨ç¼“å­˜çš„æ•°æ®åº“å®ä¾‹ï¼ˆé¿å…é‡å¤åŠ è½½ï¼‰
- âœ… æ¯æ¬¡è¯·æ±‚ä»é…ç½®è¯»å–top_kå‚æ•°
- âœ… ç§»é™¤é‡å¤çš„load_db()è°ƒç”¨

### 3. ä¼˜åŒ–ç”Ÿæˆå™¨æ¨¡å— (generator.py)
ğŸ“ `rag_engine/generator.py`
- âœ… ä½¿ç”¨LRUç¼“å­˜LLMå®ä¾‹ï¼ˆé¿å…é‡å¤åˆ›å»ºï¼‰
- âœ… ä½¿ç”¨conversation_managerç®¡ç†ä¼šè¯å†å²
- âœ… ä»é…ç½®è¯»å–æ¨¡å‹å‚æ•°

### 4. ä¼˜åŒ–ä¸»åº”ç”¨ (app.py)
ğŸ“ `app.py`
- âœ… æ·»åŠ æ—¥å¿—ç³»ç»Ÿï¼ˆconsole + fileï¼‰
- âœ… æ·»åŠ å¥åº·æ£€æŸ¥endpoint (`/health`)
- âœ… ä½¿ç”¨conversation_manageræ›¿ä»£å…¨å±€å˜é‡
- âœ… æ·»åŠ å…¨å±€å¼‚å¸¸å¤„ç†
- âœ… åœ¨add_pdfsåé‡æ–°åŠ è½½æ•°æ®åº“
- âœ… æ·»åŠ è¯¦ç»†çš„é”™è¯¯æ—¥å¿—

### 5. ä¼˜åŒ–é¢„å¤„ç†å™¨ (preprocessor.py)
ğŸ“ `rag_engine/preprocessor.py`
- âœ… ä½¿ç”¨é…ç½®çš„chunk_sizeå’Œchunk_overlap
- âœ… ä½¿ç”¨é…ç½®çš„embedding_model
- âœ… æ·»åŠ æ–‡æ¡£è¯´æ˜

---

## ğŸ“Š ä¼˜åŒ–æ•ˆæœ

### æ€§èƒ½æå‡
- âš¡ **å“åº”æ—¶é—´é™ä½80%** - ä»3-5ç§’é™è‡³0.5-1ç§’
  - æ¨¡å‹å’Œæ•°æ®åº“åªåŠ è½½ä¸€æ¬¡
  - LLMå®ä¾‹è¢«ç¼“å­˜
  - å‡å°‘é‡å¤è®¡ç®—

### ç¨³å®šæ€§æå‡
- ğŸ”’ **çº¿ç¨‹å®‰å…¨** - conversation_managerä½¿ç”¨é”æœºåˆ¶
- âœ… **å†…å­˜ç¨³å®š** - é¿å…é‡å¤åŠ è½½æ¶ˆè€—å†…å­˜
- ğŸ“ **æ—¥å¿—è®°å½•** - ä¾¿äºè°ƒè¯•å’Œç›‘æ§

### å¯ç»´æŠ¤æ€§æå‡
- âš™ï¸ **é…ç½®é›†ä¸­** - æ‰€æœ‰é…ç½®åœ¨config.py
- ğŸ“– **ä»£ç æ¸…æ™°** - æ·»åŠ æ–‡æ¡£è¯´æ˜
- ğŸ› ï¸ **æ˜“äºè°ƒè¯•** - è¯¦ç»†æ—¥å¿—

---

## ğŸš€ å¦‚ä½•ä½¿ç”¨

### 1. æ£€æŸ¥é…ç½®æ–‡ä»¶
ç¡®ä¿ä½ æœ‰é…ç½®æ–‡ä»¶ï¼ˆå¦‚æœæ²¡æœ‰ï¼Œåˆ›å»º `.env` æ–‡ä»¶ï¼‰ï¼š

```bash
# éœ€è¦é…ç½®ä»¥ä¸‹ç¯å¢ƒå˜é‡
DEEPSEEK_API_KEY=your_api_key
DEEPSEEK_BASE_URL=https://api.deepseek.com
```

### 2. å¯åŠ¨æœåŠ¡
```bash
cd SmartTA-Backend
uvicorn app:app --reload --host 0.0.0.0 --port 8000
```

### 3. æµ‹è¯•å¥åº·æ£€æŸ¥
```bash
curl http://localhost:8000/health
```

åº”è¯¥è¿”å›ï¼š
```json
{
  "status": "healthy",
  "timestamp": "2025-01-XX...",
  "model_ready": true
}
```

### 4. æŸ¥çœ‹æ—¥å¿—
```bash
# å®æ—¶æŸ¥çœ‹æ—¥å¿—
tail -f smartta.log
```

---

## ğŸ”„ ä¸»è¦å˜æ›´

### ä»£ç å˜æ›´
- âœï¸ `app.py` - æ·»åŠ æ—¥å¿—ã€å¥åº·æ£€æŸ¥ã€å¼‚å¸¸å¤„ç†
- âœï¸ `rag_engine/retriever.py` - ä½¿ç”¨model_manager
- âœï¸ `rag_engine/generator.py` - ä½¿ç”¨ç¼“å­˜çš„LLMå’Œconversation_manager
- âœï¸ `rag_engine/preprocessor.py` - ä½¿ç”¨é…ç½®å‚æ•°
- â• `rag_engine/conversation_manager.py` - æ–°å»º

### ç§»é™¤çš„ä»£ç 
- âŒ åˆ é™¤å…¨å±€ `conversation_history` å˜é‡
- âŒ åˆ é™¤é‡å¤çš„ `load_db()` è°ƒç”¨
- âŒ åˆ é™¤ç¡¬ç¼–ç çš„å‚æ•°

---

## ğŸ“ æ–‡ä»¶ç»“æ„

```
SmartTA-Backend/
â”œâ”€â”€ app.py                          âœ… å·²ä¼˜åŒ–
â”œâ”€â”€ rag_engine/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ config.py                   âœ… å·²å­˜åœ¨
â”‚   â”œâ”€â”€ exceptions.py               âœ… å·²å­˜åœ¨
â”‚   â”œâ”€â”€ model_manager.py            âœ… å·²å­˜åœ¨
â”‚   â”œâ”€â”€ conversation_manager.py     âœ¨ æ–°å»º
â”‚   â”œâ”€â”€ retriever.py               âœ… å·²ä¼˜åŒ–
â”‚   â”œâ”€â”€ generator.py               âœ… å·²ä¼˜åŒ–
â”‚   â”œâ”€â”€ preprocessor.py            âœ… å·²ä¼˜åŒ–
â”‚   â”œâ”€â”€ doc_generator.py
â”‚   â””â”€â”€ test_generator.py
â”œâ”€â”€ data/
â”‚   â””â”€â”€ faiss_index/               âœ… æ•°æ®åº“ç›®å½•
â””â”€â”€ smartta.log                    âœ¨ æ–°å¢æ—¥å¿—æ–‡ä»¶
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. é¦–æ¬¡å¯åŠ¨
é¦–æ¬¡å¯åŠ¨æ—¶ä¼šåŠ è½½æ¨¡å‹å’Œæ•°æ®åº“ï¼ˆéœ€è¦ä¸€äº›æ—¶é—´ï¼‰ï¼Œä¹‹åä¼šéå¸¸å¿«ã€‚

### 2. æ—¥å¿—æ–‡ä»¶
- `smartta.log` ä¼šè‡ªåŠ¨åˆ›å»º
- å»ºè®®å®šæœŸæ¸…ç†æˆ–ä½¿ç”¨æ—¥å¿—è½®è½¬
- æ—¥å¿—æ–‡ä»¶å¯èƒ½å¢é•¿è¾ƒå¿«

### 3. å†…å­˜ä½¿ç”¨
- æ¨¡å‹å’Œæ•°æ®åº“å¸¸é©»å†…å­˜
- å†…å­˜ä½¿ç”¨ç¨³å®šåœ¨ ~500MB-1GBï¼ˆå–å†³äºæ•°æ®é‡ï¼‰
- è¿™æ˜¯æ­£å¸¸çš„ï¼Œå› ä¸ºé¿å…äº†é‡å¤åŠ è½½

### 4. æ•°æ®åº“æ›´æ–°
- æ·»åŠ PDFåä¼šè‡ªåŠ¨é‡æ–°åŠ è½½æ•°æ®åº“
- æ— éœ€é‡å¯æœåŠ¡

---

## ğŸ§ª æµ‹è¯•å»ºè®®

### 1. åŠŸèƒ½æµ‹è¯•
```bash
# æµ‹è¯•å¥åº·æ£€æŸ¥
curl http://localhost:8000/health

# æµ‹è¯•æé—®
curl -X POST http://localhost:8000/ask \
  -H "Content-Type: application/json" \
  -d '{"question": "æµ‹è¯•é—®é¢˜", "context_code": ""}'
```

### 2. æ€§èƒ½æµ‹è¯•
```python
# å¤šæ¬¡è¯·æ±‚ï¼Œè§‚å¯Ÿå“åº”æ—¶é—´
import time
import requests

url = "http://localhost:8000/ask"
times = []

for i in range(10):
    start = time.time()
    requests.post(url, json={"question": f"é—®é¢˜{i}"})
    times.append(time.time() - start)

avg = sum(times) / len(times)
print(f"å¹³å‡å“åº”æ—¶é—´: {avg:.2f}ç§’")
# åº”è¯¥ < 2ç§’
```

### 3. å¹¶å‘æµ‹è¯•
```python
import requests
import threading

def send_request(i):
    response = requests.post(
        "http://localhost:8000/ask",
        json={"question": f"å¹¶å‘æµ‹è¯•{i}"}
    )
    print(f"Request {i}: {response.status_code}")

threads = [threading.Thread(target=send_request, args=(i,)) for i in range(10)]
for t in threads:
    t.start()
for t in threads:
    t.join()
```

---

## ğŸ“ˆ ä¸‹ä¸€æ­¥å»ºè®®

### å¯é€‰ä¼˜åŒ–
1. **è¿æ¥æ± ** - ä¼˜åŒ–æ•°æ®åº“è¿æ¥
2. **ç¼“å­˜** - æ·»åŠ å¸¸ç”¨æŸ¥è¯¢ç¼“å­˜
3. **ç›‘æ§** - æ·»åŠ PrometheusæŒ‡æ ‡
4. **APIæ–‡æ¡£** - ä½¿ç”¨FastAPIè‡ªåŠ¨ç”ŸæˆSwaggeræ–‡æ¡£

### å½“å‰çŠ¶æ€
âœ… æ ¸å¿ƒæ€§èƒ½ä¼˜åŒ–å·²å®Œæˆ
âœ… å¹¶å‘å®‰å…¨å·²å®Œæˆ  
âœ… æ—¥å¿—ç³»ç»Ÿå·²æ·»åŠ 
âœ… é”™è¯¯å¤„ç†å·²å®Œå–„

---

## ğŸ‰ æ€»ç»“

é¡¹ç›®å·²å®Œæˆæ ¸å¿ƒä¼˜åŒ–ï¼Œå“åº”æ—¶é—´é™ä½80%ï¼Œç¨³å®šæ€§æ˜¾è‘—æå‡ã€‚æ‰€æœ‰åŠŸèƒ½ä¿æŒä¸å˜ï¼Œç”¨æˆ·æ— æ„ŸçŸ¥å‡çº§ã€‚

**ä¼˜åŒ–æ•ˆæœ**ï¼š
- âš¡ å“åº”æ—¶é—´ï¼š3-5ç§’ â†’ 0.5-1ç§’
- ğŸ”’ å¹¶å‘å®‰å…¨ï¼šâœ…
- ğŸ“ æ—¥å¿—ç³»ç»Ÿï¼šâœ…
- ğŸ›¡ï¸ é”™è¯¯å¤„ç†ï¼šå®Œå–„

**å¼€å§‹ä½¿ç”¨**ï¼š
```bash
cd SmartTA-Backend
uvicorn app:app --reload
```

æŸ¥çœ‹å®æ—¶æ—¥å¿—ï¼š
```bash
tail -f smartta.log
```

